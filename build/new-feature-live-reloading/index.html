<!doctype html>
<html>
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
  <title>New Feature&#58; Live Reloading - Nanobox Blog</title>
  <link rel="shortcut icon" type="image/png" href="/images/favicon-57864095.png"/>
  <link href='https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
  <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
  <link href="/stylesheets/all-56ed7628.css" rel="stylesheet" type="text/css" />
  <script src="/javascripts/all-ca42ab1c.js" type="text/javascript"></script>
  <!-- Google Analytics -->
  <script>
    window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
    ga('create', 'UA-760419-20', 'auto');
    ga('send', 'pageview');
  </script>
  <script async src='//www.google-analytics.com/analytics.js'></script>
</head>
  <body>
  <div class='top-nav'>
  <a href="https://nanobox.io"><svg enable-background='new 0 0 19 33' id='nb-logo-sm' space='preserve' version='1.1' viewbox='0 0 19 33' x='0px' xmlns:xlink='http://www.w3.org/1999/xlink' xmlns='http://www.w3.org/2000/svg' y='0px'>
    <g>
      <g>
        <polygon fill='#405C70' points='19,26 9.6,30.9 0,26 9.4,21.1'></polygon>
        <polygon fill='#2F4352' points='15,24 9.5,26.9 3.9,24 9.4,21.1'></polygon>
        <polygon fill='#1C2830' points='9.6,30.9 19,26.1 19,27.4 9.6,32.3 '></polygon>
        <polygon fill='#19242B' points='9.6,30.9 0,26 0,27.3 9.6,32.3 '></polygon>
      </g>
      <g>
        <polygon fill='#1E77A3' points='9.5,23.1 17.2,19.1 17.2,20.3 9.5,24.2 '></polygon>
        <polygon fill='#175D80' points='9.5,23.1 1.8,19.1 1.8,20.3 9.5,24.2 '></polygon>
        <polygon fill='#62B1DD' points='17.2,19.1 9.5,23.1 1.8,19.1 9.5,15.2'></polygon>
        <polygon enable-background='new' fill='#0B194F' opacity='0.42' points='15.1,18.1 9.5,21 3.9,18.1 9.5,15.2 '></polygon>
      </g>
      <g>
        <polygon fill='#43C494' points='9.5,16.9 18.8,12.2 18.8,13.5 9.5,18.3 '></polygon>
        <polygon fill='#4AAA88' points='9.5,16.9 0.2,12.2 0.2,13.5 9.5,18.3 '></polygon>
        <polygon fill='#7FE0BF' points='18.8,12.2 9.5,16.9 0.2,12.2 9.5,7.4 '></polygon>
        <polygon enable-background='new' fill='#43C4A6' opacity='0.76' points='16.3,10.9 9.5,14.4 2.7,10.9 9.5,7.4'></polygon>
      </g>
      <g>
        <polygon fill='#FDE5A6' points='18.8,4.8 9.5,9.6 0.2,4.8 9.5,0'></polygon>
        <polygon fill='#E9D399' points='9.5,9.6 18.8,4.8 18.8,6.2 9.5,11'></polygon>
        <polygon fill='#D9BB6F' points='9.5,9.6 0.2,4.8 0.2,6.2 9.5,11'></polygon>
      </g>
    </g>
  </svg>
  <svg enable-background='new 0 0 123.9 15.9' id='nb-logotype' space='preserve' version='1.1' viewbox='0 0 123.9 15.9' x='0px' xmlns:xlink='http://www.w3.org/1999/xlink' xmlns='http://www.w3.org/2000/svg' y='0px'>
    <path d='M1.6,0.3l8.9,12.9h0V0.3H12v15.3h-1.6L1.5,2.7h0v12.9H0V0.3H1.6z' fill='#466479'></path>
    <path d='M25.1,0.3l6,15.3h-1.6l-1.9-4.8h-7l-1.9,4.8h-1.5l6.2-15.3H25.1z M27.2,9.6l-3-7.8l-3.1,7.8L27.2,9.6&#x000A;			L27.2,9.6z' fill='#466479'></path>
    <path d='M37.9,0.3l8.9,12.9h0V0.3h1.5v15.3h-1.6L37.8,2.7h0v12.9h-1.5V0.3H37.9z' fill='#466479'></path>
    <path d='M54.9,5c0.3-1,0.8-1.8,1.4-2.5c0.6-0.7,1.4-1.3,2.3-1.8c0.9-0.4,2-0.7,3.2-0.7c1.2,0,2.2,0.2,3.1,0.7&#x000A;			c0.9,0.4,1.6,1,2.3,1.8C67.7,3.1,68.2,4,68.5,5c0.3,1,0.5,2,0.5,3c0,1.1-0.1,2.1-0.5,3c-0.3,1-0.8,1.8-1.4,2.5&#x000A;			c-0.6,0.7-1.4,1.3-2.3,1.7c-0.9,0.4-1.9,0.7-3.1,0.7c-1.2,0-2.3-0.2-3.2-0.7c-0.9-0.4-1.7-1-2.3-1.7c-0.6-0.7-1.1-1.6-1.4-2.5&#x000A;			c-0.3-1-0.4-2-0.4-3S54.6,5.9,54.9,5z M56.3,10.4c0.2,0.8,0.6,1.5,1,2.2c0.5,0.6,1.1,1.1,1.8,1.5c0.7,0.4,1.6,0.6,2.6,0.6&#x000A;			c1,0,1.9-0.2,2.6-0.6c0.7-0.4,1.3-0.9,1.8-1.5c0.5-0.6,0.8-1.4,1-2.2c0.2-0.8,0.3-1.6,0.3-2.5c0-0.8-0.1-1.7-0.3-2.5&#x000A;			c-0.2-0.8-0.6-1.5-1-2.2c-0.5-0.6-1.1-1.1-1.8-1.5c-0.7-0.4-1.6-0.6-2.6-0.6c-1,0-1.9,0.2-2.6,0.6c-0.7,0.4-1.3,0.9-1.8,1.5&#x000A;			c-0.5,0.6-0.8,1.4-1,2.2C56,6.3,55.9,7.1,55.9,8C55.9,8.8,56,9.6,56.3,10.4z' fill='#466479'></path>
    <path d='M81.5,0.3c0.6,0,1.3,0.1,1.9,0.2c0.6,0.1,1.1,0.3,1.6,0.6c0.4,0.3,0.8,0.7,1.1,1.2&#x000A;			c0.3,0.5,0.4,1.1,0.4,1.8c0,0.4-0.1,0.8-0.2,1.2c-0.1,0.4-0.3,0.7-0.5,1c-0.2,0.3-0.5,0.6-0.8,0.8s-0.7,0.4-1.1,0.5v0&#x000A;			c1,0.1,1.8,0.5,2.4,1.2c0.6,0.7,0.9,1.5,0.9,2.5c0,0.2,0,0.5-0.1,0.8c0,0.3-0.1,0.6-0.3,0.9c-0.1,0.3-0.3,0.6-0.6,1&#x000A;			c-0.2,0.3-0.6,0.6-1,0.8c-0.4,0.2-0.9,0.4-1.5,0.6c-0.6,0.1-1.3,0.2-2.1,0.2H75V0.3L81.5,0.3L81.5,0.3L81.5,0.3L81.5,0.3z M81.5,7&#x000A;			C82.1,7,82.6,7,83,6.8c0.4-0.1,0.8-0.3,1.1-0.6c0.3-0.2,0.5-0.5,0.6-0.8c0.1-0.3,0.2-0.6,0.2-1c0-1.9-1.1-2.9-3.5-2.9h-5V7L81.5,7&#x000A;			L81.5,7z M81.5,14.4c0.5,0,1.1,0,1.5-0.1c0.5-0.1,0.9-0.3,1.3-0.5c0.4-0.2,0.7-0.6,0.9-1c0.2-0.4,0.3-0.9,0.3-1.5&#x000A;			c0-1-0.3-1.7-1-2.2c-0.7-0.5-1.7-0.7-3-0.7h-5v6.1L81.5,14.4L81.5,14.4z' fill='#466479'></path>
    <path d='M92.8,5c0.3-1,0.8-1.8,1.4-2.5c0.6-0.7,1.4-1.3,2.3-1.8c0.9-0.4,2-0.7,3.2-0.7c1.2,0,2.3,0.2,3.1,0.7&#x000A;			c0.9,0.4,1.6,1,2.2,1.8c0.6,0.7,1.1,1.6,1.4,2.5c0.3,1,0.4,2,0.4,3c0,1.1-0.1,2.1-0.4,3c-0.3,1-0.8,1.8-1.4,2.5&#x000A;			c-0.6,0.7-1.4,1.3-2.2,1.7c-0.9,0.4-2,0.7-3.1,0.7c-1.2,0-2.3-0.2-3.2-0.7c-0.9-0.4-1.7-1-2.3-1.7c-0.6-0.7-1.1-1.6-1.4-2.5&#x000A;			c-0.3-1-0.5-2-0.5-3S92.5,5.9,92.8,5z M94.2,10.4c0.2,0.8,0.6,1.5,1,2.2c0.5,0.6,1.1,1.1,1.8,1.5c0.7,0.4,1.6,0.6,2.6,0.6&#x000A;			c1,0,1.9-0.2,2.6-0.6c0.7-0.4,1.3-0.9,1.8-1.5c0.5-0.6,0.8-1.4,1-2.2c0.2-0.8,0.3-1.6,0.3-2.5c0-0.8-0.1-1.7-0.3-2.5&#x000A;			c-0.2-0.8-0.6-1.5-1-2.2c-0.5-0.6-1.1-1.1-1.8-1.5c-0.7-0.4-1.6-0.6-2.6-0.6c-1,0-1.9,0.2-2.6,0.6c-0.7,0.4-1.3,0.9-1.8,1.5&#x000A;			c-0.5,0.6-0.8,1.4-1,2.2c-0.2,0.8-0.3,1.6-0.3,2.5C93.8,8.8,93.9,9.6,94.2,10.4z' fill='#466479'></path>
    <path d='M113.2,0.3l4.3,6.4l4.5-6.4h1.6l-5.2,7.5l5.5,7.8h-1.8l-4.7-6.8l-4.7,6.8h-1.6l5.5-7.9l-5.2-7.4L113.2,0.3&#x000A;			L113.2,0.3z' fill='#466479'></path>
  </svg>
  </a>
  <a class='blog' href='/'>Blog</a>
  <ul class='right'>
    <li id='docs'>
      <a href='https://docs.nanobox.io'>Docs</a>
    </li>
    <li id='desktop'>
      <a href='https://desktop.nanobox.io'>Desktop</a>
    </li>
    <li id='login'>
      <a href='https://dashboard.nanobox.io'>Login/Register</a>
    </li>
  </ul>
</div>
    
    <div class="wrapper fade-in">
      <div class="title-block">
        <h1>New Feature&#58; Live Reloading</h1>
        <p class="meta">
          <span class="author">Tyler Flint</span>
           &#9642; 
          <span class="date">Dec 11 2015</span>
        </p>
      </div>
      <div class="content">
        <p>These days, almost every modern web framework is embracing the ability to live reload the browser when a source file is modified. It’s a cool trend; one we happen to use daily on most of our web applications. Over the past 6 months we’ve been obsessed with figuring out how to develop an application using livereload in dev mode on nanobox. In the past couple of weeks, thanks in large part to <a href="https://github.com/lyondhill">Lyon</a>, we’ve made some great progress towards this goal and today we’re excited to release and demo this functionality.</p>

<p><strong>TLDR:</strong> Livereload works on nanobox! Check it out in the demo <a href="#video-demo">below</a>. </p>

<h2 id="the-problem">The Problem</h2>

<p>Generally, livereload (outside of nanobox) works by subscribing to an I/O event notification layer provided by the operating system kernel. The livereload library “watches” files and directories for changes, then waits for the event notification from the kernel indicating a file or directory has been modified. When a file is modified, certain hooks run which may re-compile code or generate static assets accordingly. The livereload server then informs the browser, connected over a websocket, that a file has been modified and the browser refreshes.</p>

<p>With nanobox, your application runs inside of a virtual machine (VM), and the source code is mounted inside. Livereload functionality breaks because the livereload server subscribes to events on the OS of the guest VM, but changes to the source code are made on the OS of the host machine. While the changes to the files are reflected inside the VM via the mount, the change event is triggered on the host OS, not on the guest OS. Thus, changes are not broadcast and the livereload server never triggers a re-compile and browser refresh.</p>

<h2 id="the-solution">The Solution</h2>

<p>Our initial instinct, after having spent the past year in kernel development on illumos, was to try to modify the behavior of NFS and the VirtualBox fs driver behavior to replicate events from the host on the client OS. This effort didn’t make it far, as it proved to be a major undertaking without any guarantee that our work would be accepted by the vendors who maintain these projects. </p>

<p>Instead, we took a step back and realized we could accomplish the goal in a much less obtrusive manner. When you run <code>nanobox dev</code>, a watcher thread (go routine if you want to be technical about it) subscribes to the kernel event notification layer and waits to be informed of changes to the source code. When a change to a file or directory is triggered, the watcher thread connects to the nanobox-server daemon inside the VM and relays the event. The nanobox-server daemon then touches the file inside the VM, which ultimately forces a propagation of the event to the livereload server. </p>

<p>It took a lot of iterations to flesh out the bugs and required a major refactor to handle tens of thousands of file change events per second. We’re excited to say that it’s now complete, stable, and working quite well! Your application doesn’t need to change or do anything special. The entire I/O event propagation and relay system is completely transparent to the application and the nanobox user.</p>

<p>I created a short demo that demonstrates this process. Enjoy!</p>

<div class="video" id="video-demo">
  <iframe width="560" height="315" src="https://www.youtube.com/embed/Donrr7YXkak?rel=0&amp;showinfo=0" frameborder="0" allowfullscreen></iframe>
</div>

<h2 id="contributor-love">Contributor Love</h2>

<p>Special thanks to all those who contributed to Nanobox &amp; Nanopack projects this week. If we missed you, let us know and we&#39;ll be sure to get you in next week.</p>

<p><strong><a href="https://github.com/Flat">Flat</a></strong><br>
- Fixed some typos in engine publishing<br>
- Made the update process more stable<br>
- Helped work through the windows update process  </p>

<p><strong><a href="https://github.com/alytvynov">alytvynov</a></strong><br>
- Fixed scribble usage on Yoke  </p>

<p><strong><a href="https://github.com/mattn">mattn</a></strong><br>
- Helped us identify and understand proxy situations  </p>

<p><strong>Walther Diechmann</strong><br>
- Helped identify LAN networking issues<br>
- Spurred a discussion that produced a plausible feature for bridge networking  </p>

<p><strong><a href="https://github.com/Andrew-College">Andrew-College</a></strong><br>
- Identified a missing shared library in Oracle Java package  </p>

<p><strong><a href="https://github.com/fnmunhoz">fnmunhoz</a></strong><br>
- Identified incorrect ruby_runtime cofigurations and helped confirm a fix  </p>

<p><strong><a href="https://github.com/ehsanminachi">ehsanminachi</a></strong><br>
- Helped identify specific yoke scenarios for documentation  </p>

<p><strong><a href="https://github.com/imkheong">imkheong</a></strong><br>
- Working to identify windows-specific Vagrantfile generation syntax errors  </p>

      </div>
      <div class="author-block">
        <img class="gravatar" src="https://s.gravatar.com/avatar/d16320670cd226d7d4984698585e2fbc">
        <div class="info">
          <p class="author"><span>Tyler Flint</span>            
             <a class="twitter" target="_blank" href="https://twitter.com/tyler_flint">@tyler_flint</a>
              <a class="github" target="_blank" href="https://github.com/tylerflint">tylerflint</a>
          </p>
          <p class="summary">Husband, dad, LDS, entrepreneur, Nanobox cofounder.</p>
        </div>
      </div>
      <div class="feedback">
        <p>Have feedback on this post? Let
          <a target="_blank" href="https://twitter.com/intent/tweet?text=@nanobox_io%20&amp;amp;url=https://blog.nanobox.io/new-feature-live-reloading/">@nanobox_io</a>
            or <a target="_blank" href="https://twitter.com/intent/tweet?text=@tyler_flint%20&amp;amp;url=https://blog.nanobox.io/new-feature-live-reloading/">@tyler_flint</a>
          know on Twitter.</p>
      </div>
      <hr class="end">
    </div>
    <aside>
  <ul>
    <li><h2>Recent Posts</h2></li>
      <li><a href="/new-feature-live-reloading/">New Feature&#58; Live Reloading</a> <span class="small-date">Dec 11</span></li>
      <li><a href="/the-vision-of-nanobox/">The Vision of Nanobox</a> <span class="small-date">Dec  4</span></li>
      <li><a href="/thanksgiving-update/">Thanksgiving Update</a> <span class="small-date">Nov 25</span></li>
      <li><a href="/3-projects-in-2-days-trend-on-hacker-news-github/">3 Projects in 2 Days Trend on Hacker News & Github</a> <span class="small-date">Nov 18</span></li>
      <li><a href="/nanopack-a-new-vision-for-automated-infrastructure/">Nanopack - A New Vision for Automated Infrastructure</a> <span class="small-date">Nov 13</span></li>
  </ul>
  <ul>
    <li><h2>Tags</h2></li>
      <li><a href="/tags/open-source/">Open Source (3)</a></li>
      <li><a href="/tags/updates/">Updates (2)</a></li>
      <li><a href="/tags/features/">Features (2)</a></li>
      <li><a href="/tags/our-vision/">Our Vision (2)</a></li>
  </ul>
  <ul>
    <li><h2>Archives</h2></li>
      <li><a href="/2015/">2015 (8)</a></li>
  </ul>
  <p class="feed">Subscribe to the <a href="/feed.xml" target="_blank">feed</a></p>
</aside>
  </body>
</html>
